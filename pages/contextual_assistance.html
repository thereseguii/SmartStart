<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartStart - AI Assistant</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f0f0f0;
        color: #333;
      }

      .header {
        background: white;
        padding: 16px 24px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .logo-icon {
        width: 24px;
        height: 24px;
        background: #b91c1c;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px;
      }

      .logo-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .logo-text {
        color: #b91c1c;
        font-weight: 600;
        font-size: 16px;
      }

      .logo-subtitle {
        color: #666;
        font-size: 12px;
        margin-left: 8px;
      }

      .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 40px 24px;
      }

      .welcome-screen {
        text-align: center;
        display: block;
      }

      .welcome-screen.hidden {
        display: none;
      }

      .chat-screen {
        display: none;
        min-height: 500px;
      }

      .chat-screen.active {
        display: block;
      }

      .bot-avatar {
        width: 80px;
        height: 80px;
        background: #b91c1c;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 32px;
        color: white;
        font-size: 32px;
      }

      .welcome-title {
        font-size: 32px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 12px;
      }

      .welcome-description {
        font-size: 15px;
        color: #6b7280;
        line-height: 1.5;
        margin-bottom: 50px;
        max-width: 520px;
        margin-left: auto;
        margin-right: auto;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .feature-card {
        background: white;
        border-radius: 12px;
        padding: 24px 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .feature-card:hover {
        transform: translateY(-2px);
      }

      .feature-icon {
        width: 48px;
        height: 48px;
        margin: 0 auto 16px;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .feature-icon.chat {
        border-radius: 12px;
        color: white;
      }

      .feature-icon.compliance {
        border-radius: 12px;
        color: white;
      }

      .feature-icon.task {
        border-radius: 12px;
        color: white;
      }

      .feature-title {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 8px;
      }

      .feature-description {
        font-size: 14px;
        color: #6b7280;
      }

      .suggestions-section {
        margin-bottom: 45px;
      }

      .suggestions-title {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
        text-align: center;
      }

      .suggestions-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .suggestion-card {
        background: white;
        border-radius: 10px;
        padding: 18px 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        text-align: left;
      }

      .suggestion-card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transform: translateY(-1px);
      }

      .suggestion-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: white;
        flex-shrink: 0;
      }

      .suggestion-icon.system {
        background: #fcd34d;
      }
      .suggestion-icon.benefits {
        background: #f59e0b;
      }
      .suggestion-icon.leave {
        background: #10b981;
      }
      .suggestion-icon.workflow {
        background: #3b82f6;
      }

      .suggestion-text {
        font-size: 14px;
        font-weight: 500;
        color: #1f2937;
      }

      .chat-input-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 4px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chat-input {
        flex: 1;
        border: none;
        outline: none;
        padding: 12px 16px;
        font-size: 14px;
        background: transparent;
      }

      .chat-input::placeholder {
        color: #9ca3af;
      }

      .send-button {
        min-width: 80px; /* Fixed button width */
        height: 40px;
        background: #b91c1c;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: background 0.2s ease;
      }

      .send-button:hover {
        background: #991b1b;
      }

      .chat-help-text {
        text-align: center;
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 24px;
      }

      .footer {
        text-align: center;
        font-size: 12px;
        color: #9ca3af;
      }

      .footer a {
        color: #b91c1c;
        text-decoration: none;
        font-weight: 500;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      /* Chat Screen Styles */
      .chat-messages {
        background: white;
        border-radius: 12px;
        min-height: 400px;
        padding: 24px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        max-height: 500px;
        overflow-y: auto;
      }

      .message {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        gap: 12px;
      }

      .message.user {
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 14px;
      }

      .message-avatar.bot {
        background: #fcd34d;
      }

      .message-avatar.user {
        background: #b91c1c;
        color: white;
        font-weight: 600;
      }

      .message-content {
        display: flex;
        flex-direction: column;
        max-width: 70%;
      }

      .message-bubble {
        padding: 12px 16px;
        border-radius: 16px;
        font-size: 14px;
        line-height: 1.4;
        margin-bottom: 4px;
      }

      .message-timestamp {
        font-size: 11px;
        opacity: 0.7;
        margin-top: 2px;
      }

      .message.bot .message-timestamp {
        color: #6b7280;
        text-align: left;
      }

      .message.user .message-timestamp {
        color: #fca5a5;
        text-align: right;
      }

      .message.bot .message-bubble {
        background: #f3f4f6;
        color: #1f2937;
        border-bottom-left-radius: 4px;
      }

      .message.user .message-bubble {
        background: #b91c1c;
        color: white;
        border-bottom-right-radius: 4px;
      }

      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 12px 16px;
        background: #f3f4f6;
        border-radius: 16px;
        border-bottom-left-radius: 4px;
        max-width: fit-content;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        background: #9ca3af;
        border-radius: 50%;
        animation: typing 1.5s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.3s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.6s;
      }

      .error-message {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #dc2626;
        padding: 12px 16px;
        border-radius: 16px;
        border-bottom-left-radius: 4px;
        max-width: fit-content;
        font-size: 14px;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          opacity: 0.3;
          transform: scale(0.8);
        }
        30% {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .features-grid {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .suggestions-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .container {
          padding: 24px 16px;
        }

        .welcome-title {
          font-size: 28px;
        }

        .bot-avatar {
          width: 64px;
          height: 64px;
        }
      }

      @media (max-width: 640px) {
        .feature-card {
          padding: 24px 16px;
        }

        .suggestion-card {
          padding: 16px 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo-icon">
        <img
          src="D:\BPI\FINAL\assets\smartstart-icon.png"
          alt="SmartStart"
          class="logo-image"
        />
      </div>
      <div class="logo-text">SmartStart</div>
      <div class="logo-subtitle">AI Assistant</div>
    </div>

    <div class="container">
      <!-- Welcome Screen -->
      <div class="welcome-screen" id="welcomeScreen">
        <div class="bot-avatar">
          <img
            src="D:\BPI\FINAL\assets\Chatbot.png"
            alt="Chatbot"
            style="width: 48px; height: 48px; object-fit: contain"
          />
        </div>

        <h1 class="welcome-title">Welcome to SmartStart</h1>
        <p class="welcome-description">
          Your AI-powered onboarding assistant is here to guide you through your
          journey at BPI. Get contextual help, access resources, and complete
          your tasks efficiently.
        </p>

        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon chat">
              <img
                src="D:\BPI\FINAL\assets\Chat.png"
                alt="Chat"
                style="width: 40px; height: 40px; object-fit: contain"
              />
            </div>
            <div class="feature-title">Conversational Support</div>
            <div class="feature-description">
              Ask questions in natural language
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon compliance">
              <img
                src="D:\BPI\FINAL\assets\Document.png"
                alt="Compliance"
                style="width: 40px; height: 40px; object-fit: contain"
              />
            </div>
            <div class="feature-title">Compliance Guidance</div>
            <div class="feature-description">
              Navigate banking regulations safely
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon task">
              <img
                src="D:\BPI\FINAL\assets\Protect.png"
                alt="Tasks"
                style="width: 40px; height: 40px; object-fit: contain"
              />
            </div>
            <div class="feature-title">Task Management</div>
            <div class="feature-description">
              Get up to speed with workflows
            </div>
          </div>
        </div>

        <div class="suggestions-section">
          <h2 class="suggestions-title">Try asking me about:</h2>
          <div class="suggestions-grid">
            <div
              class="suggestion-card"
              onclick="selectSuggestion('How do I request System Access?')"
            >
              <div class="suggestion-icon">
                <img
                  src="D:\BPI\FINAL\assets\Access.png"
                  alt="Access"
                  style="width: 22px; height: 22px; object-fit: contain"
                />
              </div>
              <div class="suggestion-text">How do I request System Access?</div>
            </div>
            <div
              class="suggestion-card"
              onclick="selectSuggestion('Who do I talk to about benefits and payroll?')"
            >
              <div class="suggestion-icon">
                <img
                  src="D:\BPI\FINAL\assets\Human Research Program.png"
                  alt="HR"
                  style="width: 22px; height: 22px; object-fit: contain"
                />
              </div>
              <div class="suggestion-text">
                Who do I talk to about benefits and payroll?
              </div>
            </div>
            <div
              class="suggestion-card"
              onclick="selectSuggestion('Walk me through submitting a leave request.')"
            >
              <div class="suggestion-icon">
                <img
                  src="D:\BPI\FINAL\assets\Attendance.png"
                  alt="Document"
                  style="width: 22px; height: 22px; object-fit: contain"
                />
              </div>
              <div class="suggestion-text">
                Walk me through submitting a leave request.
              </div>
            </div>
            <div
              class="suggestion-card"
              onclick="selectSuggestion('How do I know when a workflow is complete?')"
            >
              <div class="suggestion-icon">
                <img
                  src="D:\BPI\FINAL\assets\Inspection.png"
                  alt="Workflow"
                  style="width: 22px; height: 22px; object-fit: contain"
                />
              </div>
              <div class="suggestion-text">
                How do I know when a workflow is complete?
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Screen -->
      <div class="chat-screen" id="chatScreen">
        <div class="chat-messages" id="chatMessages">
          <!-- Messages will be added here dynamically -->
        </div>
      </div>

      <!-- Input Container -->
      <div class="chat-input-container">
        <input
          type="text"
          class="chat-input"
          id="chatInput"
          placeholder="Ask me anything about your onboarding process..."
          onkeypress="handleKeyPress(event)"
        />
        <button class="send-button" id="sendButton" onclick="sendMessage()">
          <img
            src="D:\BPI\FINAL\assets\Paper Plane Message.png"
            alt="Send"
            style="width: 25px; height: 25px; object-fit: contain"
          />
          Send
        </button>
      </div>

      <div class="chat-help-text">
        SmartStart can help with onboarding tasks, compliance questions, and
        system access
      </div>

      <div class="footer">
        Powered by <a href="#">SmartStart</a> — A BPI Innovation
      </div>
    </div>

    <script>
      let isFirstMessage = true;
      require("dotenv").config();
      const HF_TOKEN = process.env.HF_TOKEN;
      let conversationHistory = [];

      function selectSuggestion(text) {
        startChat(text);
      }

      function startChat(message) {
        document.getElementById("welcomeScreen").classList.add("hidden");
        document.getElementById("chatScreen").classList.add("active");

        if (message) {
          document.getElementById("chatInput").value = message;
          sendMessage();
        }
      }

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      async function sendMessage() {
        const input = document.getElementById("chatInput");
        const sendButton = document.getElementById("sendButton");
        const message = input.value.trim();

        if (!message) return;

        input.disabled = true;
        sendButton.disabled = true;

        if (
          isFirstMessage &&
          !document.getElementById("chatScreen").classList.contains("active")
        ) {
          startChat();
          input.value = message;
        }

        addMessage(message, "user");
        input.value = "";
        showTypingIndicator();

        try {
          console.log("Sending message:", message);
          const response = await getBotResponse(message);
          console.log("Got response:", response);
          hideTypingIndicator();
          addMessage(response, "bot");
        } catch (error) {
          console.error("Error:", error);
          hideTypingIndicator();
          addMessage(
            "❌ I'm having trouble right now. Please try again.",
            "bot"
          );
        } finally {
          input.disabled = false;
          sendButton.disabled = false;
          input.focus();
        }
      }

      async function getBotResponse(message) {
        try {
          console.log("Calling BPI Chatbot API...");

          const response = await fetch(
            "http://localhost:5005/webhooks/rest/webhook",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                sender: "user",
                message: message,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`Chatbot API failed: ${response.status}`);
          }

          const data = await response.json();
          console.log("Chatbot response:", data);

          if (data && data.length > 0 && data[0].text) {
            return data[0].text;
          } else {
            throw new Error("No response from chatbot");
          }
        } catch (error) {
          console.error("Chatbot API failed:", error);
          return getFallbackResponse(message);
        }
      }

      function addMessage(text, sender) {
        const messagesContainer = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}`;

        const avatar = document.createElement("div");
        avatar.className = `message-avatar ${sender}`;
        if (sender === "bot") {
          avatar.innerHTML =
            '<img src="D:\\BPI\\FINAL\\assets\\Chatbot.png" alt="Bot" style="width: 20px; height: 20px; object-fit: contain;">';
        } else {
          avatar.textContent = "M";
        }

        const messageContent = document.createElement("div");
        messageContent.className = "message-content";

        const bubble = document.createElement("div");
        bubble.className = "message-bubble";

        // Format text with proper line breaks
        const formattedText = formatMessage(text);
        bubble.innerHTML = formattedText;

        const timestamp = document.createElement("div");
        timestamp.className = "message-timestamp";
        timestamp.textContent = getCurrentTime();

        messageContent.appendChild(bubble);
        messageContent.appendChild(timestamp);

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageContent);
        messagesContainer.appendChild(messageDiv);

        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        isFirstMessage = false;
      }

      function addErrorMessage(text) {
        const messagesContainer = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message bot";

        const avatar = document.createElement("div");
        avatar.className = "message-avatar bot";
        avatar.innerHTML =
          '<img src="D:\\BPI\\FINAL\\assets\\Chatbot.png" alt="Bot" style="width: 20px; height: 20px; object-fit: contain;">';

        const messageContent = document.createElement("div");
        messageContent.className = "message-content";

        const bubble = document.createElement("div");
        bubble.className = "error-message";
        bubble.textContent = text;

        const timestamp = document.createElement("div");
        timestamp.className = "message-timestamp";
        timestamp.textContent = getCurrentTime();

        messageContent.appendChild(bubble);
        messageContent.appendChild(timestamp);

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageContent);
        messagesContainer.appendChild(messageDiv);

        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function formatMessage(text) {
        // Convert line breaks to HTML breaks
        let formatted = text.replace(/\n/g, "<br>");

        // Format numbered lists
        formatted = formatted.replace(/(\d+\.\s)/g, "<br>$1");

        // Format bullet points
        formatted = formatted.replace(/•\s/g, "<br>• ");

        // Clean up extra breaks at the beginning
        formatted = formatted.replace(/^<br>/, "");

        // Format bold text
        formatted = formatted.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

        return formatted;
      }

      function getCurrentTime() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const ampm = hours >= 12 ? "PM" : "AM";
        const displayHours = hours % 12 || 12;
        const displayMinutes = minutes.toString().padStart(2, "0");
        return `${displayHours}:${displayMinutes} ${ampm}`;
      }

      function showTypingIndicator() {
        const messagesContainer = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");
        typingDiv.className = "message bot";
        typingDiv.id = "typingIndicator";

        const avatar = document.createElement("div");
        avatar.className = "message-avatar bot";
        avatar.innerHTML =
          '<img src="D:\\BPI\\FINAL\\assets\\Chatbot.png" alt="Bot" style="width: 20px; height: 20px; object-fit: contain;">';

        const messageContent = document.createElement("div");
        messageContent.className = "message-content";

        const typingBubble = document.createElement("div");
        typingBubble.className = "typing-indicator";
        typingBubble.innerHTML =
          '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

        messageContent.appendChild(typingBubble);
        typingDiv.appendChild(avatar);
        typingDiv.appendChild(messageContent);
        messagesContainer.appendChild(typingDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function hideTypingIndicator() {
        const typingIndicator = document.getElementById("typingIndicator");
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      // Auto-focus on input when page loads
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("chatInput").focus();
      });
    </script>
  </body>
</html>
